---
import Modal from '../Modal.astro';
import SecretsVault from './SecretsVault.astro';
---

<Modal
  id="secrets-vault-modal"
  title="Secrets Vault"
  size="xl"
  showActions={false}
>
  <SecretsVault
    showHeader={false}
    compact={true}
    containerId="secrets-vault-modal-content"
  />
</Modal>

<script>
  // Global function to open vault modal
  window.openSecretsVault = () => {
    const modal = document.getElementById('secrets-vault-modal') as any;
    if (modal?.open) {
      modal.open();

      // Check status when modal opens
      if (window.secretsVaultManager) {
        window.secretsVaultManager.checkStatus();
      }
    }
  };

  // Listen for successful save in modal
  window.addEventListener('secrets-vault:saved', () => {
    // Show success toast
    window.dispatchEvent(
      new CustomEvent('artsitemaker:toast', {
        detail: {
          title: 'Secrets saved successfully',
          variant: 'success',
        },
      })
    );

    // Close modal after 2 seconds
    setTimeout(() => {
      const modal = document.getElementById('secrets-vault-modal') as any;
      modal?.close();
    }, 2000);
  });
</script>
